<div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">f</span> <span class="o">=</span> <span class="n">flash</span><span class="o">.</span><span class="n">to_hash</span>  <span class="c1"># A real hash is easier to manipulate without deprecation nags, and should be safe enough </span><span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">f</span><span class="o">[</span><span class="ss">:mail</span><span class="o">]</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;mail_flash&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4&gt;</span>Mail that would have been sent:<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;pre&gt;</span><span class="cp">&lt;%=</span> <span class="n">auto_link</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:mail</span><span class="p">)))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/pre&gt;</span>
    <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to_function</span><span class="p">(</span><span class="s2">&quot;Discard&quot;</span><span class="p">,</span> <span class="s2">&quot;mf = document.getElementById(&#39;mail_flash&#39;); mf.parentNode.removeChild(mf)&quot;</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">f</span><span class="o">.</span><span class="n">empty?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;messages&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">f</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">kind</span><span class="p">,</span> <span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;</span><span class="cp">&lt;%=</span> <span class="n">kind</span> <span class="cp">%&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre>
</div>

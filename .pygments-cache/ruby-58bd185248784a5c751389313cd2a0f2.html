<div class="highlight"><pre><span class="nb">require</span> <span class="s2">&quot;CGI&quot;</span>

<span class="no">TO_FILE</span> <span class="o">=</span> <span class="s2">&quot;/tmp/adium.txt&quot;</span>
<span class="no">ACCOUNT</span> <span class="o">=</span> <span class="s2">&quot;ICQ.4618664&quot;</span>
<span class="no">CONTACT</span> <span class="o">=</span> <span class="s2">&quot;1234567&quot;</span>
<span class="n">output</span> <span class="o">=</span> <span class="o">[]</span>

<span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;HOME&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">/Library/Application\ Support/Adium\ 2.0/Users/Default/Logs/</span><span class="si">#{</span><span class="no">ACCOUNT</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">CONTACT</span><span class="si">}</span><span class="s2">/*&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="o">|</span>
	<span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
		<span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="no">CGI</span><span class="o">.</span><span class="n">unescapeHTML</span><span class="p">(</span><span class="vg">$1</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">%r{&lt;/?[^&gt;]+&gt;}</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span> <span class="o">=~</span> <span class="sr">%r{&lt;div class=&quot;receive&quot;&gt;.*?&lt;pre class=&quot;message&quot;&gt;(.*?)&lt;/pre&gt;&lt;/div&gt;}</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="no">TO_FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
	<span class="n">file</span><span class="o">.</span><span class="n">puts</span> <span class="n">output</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre>
</div>

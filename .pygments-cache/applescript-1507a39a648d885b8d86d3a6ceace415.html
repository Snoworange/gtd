<div class="highlight"><pre><span class="cm">(*</span>
<span class="cm">&quot;Peekaboo Stack Overlay&quot; by Henrik Nyh &lt;http://henrik.nyh.se/2007/11/hide-leopard-stack-overlays-in-finder&gt;</span>
<span class="cm">This Folder Action handler is triggered whenever items are added to or removed from the attached folder (and indirectly when they&#39;re renamed).</span>
<span class="cm">When that happens, it will juggle visible bits and temp files to make the stack reload while the icon is non-hidden, and then hides it again. The end result is that you can keep the icon file hidden in the Finder but still see it overlayed on the stack (and in the expanded stack, alas).</span>
<span class="cm">This script assumes an icon named &quot; Icon&quot; (with the space, so it sorts first in alphabetical stacks).</span>
<span class="cm">*)</span>

<span class="k">on</span> <span class="nv">adding</span> <span class="nv">folder</span> <span class="nb">items</span> <span class="k">to</span> <span class="nv">thisFolder</span>
  <span class="nv">reapplyStackOverlay</span><span class="p">(</span><span class="nv">thisFolder</span><span class="p">)</span>
<span class="k">end</span> <span class="nv">adding</span> <span class="nv">folder</span> <span class="nb">items</span> <span class="k">to</span>

<span class="k">on</span> <span class="nv">removing</span> <span class="nv">folder</span> <span class="nb">items</span> <span class="k">from</span> <span class="nv">thisFolder</span>
  <span class="nv">reapplyStackOverlay</span><span class="p">(</span><span class="nv">thisFolder</span><span class="p">)</span>
<span class="k">end</span> <span class="nv">removing</span> <span class="nv">folder</span> <span class="nb">items</span> <span class="k">from</span>

<span class="k">on</span> <span class="nv">reapplyStackOverlay</span><span class="p">(</span><span class="nv">thisFolder</span><span class="p">)</span>
  <span class="c">-- Something happened to reload the stack.</span>
  <span class="k">set</span> <span class="nv">folderPath</span> <span class="k">to</span> <span class="p">(</span><span class="nv">POSIX</span> <span class="na">path</span> <span class="k">of</span> <span class="p">(</span><span class="nv">thisFolder</span> <span class="k">as</span> <span class="nv">alias</span><span class="p">))</span>
  <span class="k">set</span> <span class="nv">iconPath</span> <span class="k">to</span> <span class="nv">folderPath</span> <span class="o">&amp;</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;</span> <span class="s2">&quot; Icon&quot;</span>
  <span class="k">set</span> <span class="nv">triggerFile</span> <span class="k">to</span> <span class="nv">folderPath</span> <span class="o">&amp;</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;</span> <span class="s2">&quot;.force_stack_reload&quot;</span>
  <span class="c">-- Unhide icon</span>
  <span class="nb">do shell script</span> <span class="s2">&quot;chflags nohidden &quot;</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">quoted form</span> <span class="k">of</span> <span class="nv">iconPath</span><span class="p">)</span>
  <span class="c">-- Force stack to reload</span>
  <span class="nb">do shell script</span> <span class="s2">&quot;touch &quot;</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">quoted form</span> <span class="k">of</span> <span class="nv">triggerFile</span><span class="p">)</span>
  <span class="nb">do shell script</span> <span class="s2">&quot;rm -f &quot;</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">quoted form</span> <span class="k">of</span> <span class="nv">triggerFile</span><span class="p">)</span>
  <span class="c">-- Hide icon</span>
  <span class="nb">do shell script</span> <span class="s2">&quot;chflags hidden &quot;</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">quoted form</span> <span class="k">of</span> <span class="nv">iconPath</span><span class="p">)</span>
<span class="k">end</span> <span class="nv">reapplyStackOverlay</span>
</pre>
</div>

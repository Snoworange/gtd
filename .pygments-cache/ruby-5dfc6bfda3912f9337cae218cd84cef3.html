<div class="highlight"><pre><span class="c1">#!/usr/bin/ruby</span>
<span class="c1">#</span>
<span class="c1"># Copies the selection (or else the line) to</span>
<span class="c1"># clipboard, but with any initial indentation</span>
<span class="c1"># stripped, so that the actual text is flush left.</span>
<span class="c1">#</span>
<span class="c1"># Because of the &quot;re-indented paste&quot; feature you might</span>
<span class="c1"># not notice this effect if you paste it back into TM.</span>
<span class="c1">#</span>
<span class="c1"># Code considers spaces and tabs equal, so two spaces</span>
<span class="c1"># are considered further indented than one tab. This</span>
<span class="c1"># will probably only cause problems if you indent with</span>
<span class="c1"># mixed tabs and spaces.</span>
<span class="c1">#</span>
<span class="c1"># By Henrik Nyh &lt;http://henrik.nyh.se&gt;.</span>
<span class="c1"># Free to modify, though please credit me.</span>

<span class="n">lines</span> <span class="o">=</span> <span class="no">STDIN</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="n">shortest_indent_length</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="n">line</span> <span class="o">=~</span> <span class="sr">/^\s*$/</span> <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="n">line</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/^\s*/</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">size</span> <span class="p">}</span><span class="o">.</span><span class="n">min</span>
<span class="n">lines</span><span class="o">.</span><span class="n">map!</span> <span class="p">{</span><span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="n">line</span><span class="o">[</span><span class="no">Range</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">shortest_indent_length</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">}</span>

<span class="no">IO</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;pbcopy&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">copier</span><span class="o">|</span> <span class="n">copier</span><span class="o">.</span><span class="n">puts</span> <span class="n">lines</span><span class="o">.</span><span class="n">join</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="s2">&quot;Undented copy has been placed in clipboard.&quot;</span>
</pre>
</div>

<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">error_messages_for</span> <span class="ss">:user</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">form_for</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="n">users_path</span><span class="p">,</span> <span class="ss">:html</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s1">&#39;registration_form&#39;</span><span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">-%&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:username</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>E-mail address<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password_label&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="n">apply_behaviour</span><span class="p">(</span><span class="s1">&#39;#password_label&#39;</span><span class="p">,</span> <span class="sx">%{</span>
<span class="sx">  const offString = &quot;Don&#39;t show what I type&quot;, onString = &quot;Show what I type&quot;;</span>
<span class="sx">  var a = document.createElement(&quot;a&quot;);</span>
<span class="sx">  this.appendChild(document.createTextNode(&quot; (&quot;)); this.appendChild(a); this.appendChild(document.createTextNode(&quot;)&quot;));</span>

<span class="sx">  function isShowing() { return $(&#39;user_password&#39;).type == &#39;text&#39;; }</span>
<span class="sx">  function mirror_password() { $(&#39;user_password_confirmation&#39;).value = $F(&#39;user_password&#39;); }</span>
<span class="sx">  function mirror_password_conditional() { if (isShowing()) mirror_password(); }</span>
<span class="sx">  function toggle_confirmation(mirrorPassword) {</span>
<span class="sx">    $(&#39;confirmation&#39;).toggle();</span>
<span class="sx">    $(&#39;user_password&#39;).type = isShowing() ? &#39;password&#39; : &#39;text&#39;;</span>
<span class="sx">    a.innerHTML = isShowing() ? offString : onString;</span>
<span class="sx">    $(&#39;confirm_password&#39;).value = isShowing() ? &#39;false&#39; : &#39;true&#39;;</span>
<span class="sx">    if (mirrorPassword) mirror_password();</span>
<span class="sx">  }</span>

<span class="sx">  toggle_confirmation(false);</span>
<span class="sx">  </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:confirm_password</span><span class="o">]==</span><span class="s1">&#39;true&#39;</span> <span class="p">?</span> <span class="s1">&#39;toggle_confirmation(false);&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sx"></span>
<span class="sx">  Event.observe(a, &#39;click&#39;, toggle_confirmation);</span>
<span class="sx">  Event.observe(&#39;registration_form&#39;, &#39;submit&#39;, mirror_password_conditional);</span>
<span class="sx">}</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">hidden_field_tag</span> <span class="s1">&#39;confirm_password&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">&quot;confirmation&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password_confirmation&quot;</span><span class="nt">&gt;</span>Confirm password<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">submit_tag</span> <span class="s1">&#39;Sign up&#39;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</pre>
</div>

<div class="highlight"><pre><span class="c1"># Modifies the innards of acts_as_solr so empty queries find every model instance</span>
<span class="c1"># instead of none, e.g. User.count_by_solr(&#39;&#39;) and Group.find_by_solr(nil).</span>

<span class="k">module</span> <span class="nn">ActsAsSolr</span>
  <span class="k">module</span> <span class="nn">FindAllExtension</span>
    <span class="no">FIND_ALL_QUERY</span> <span class="o">=</span> <span class="s1">&#39;type:[* TO *]&#39;</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
      <span class="n">mod</span><span class="o">.</span><span class="n">alias_method_chain</span> <span class="ss">:parse_query</span><span class="p">,</span> <span class="ss">:find_all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse_query_with_find_all</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
      <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">blank?</span> <span class="p">?</span> <span class="no">FIND_ALL_QUERY</span> <span class="p">:</span> <span class="n">query</span>
      <span class="n">parse_query_without_find_all</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">ActsAsSolr::ParserMethods</span>
  <span class="kp">include</span> <span class="no">ActsAsSolr</span><span class="o">::</span><span class="no">FindAllExtension</span>
<span class="k">end</span>
</pre>
</div>

<div class="highlight"><pre><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># By Henrik Nyh 2007-04-14.</span>
<span class="c1"># Free to modify and redistribute with due credit.</span>

<span class="no">USERNAME</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
<span class="no">PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="no">MAKE_PRIVATE_BEFORE</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="mi">2004</span><span class="p">,</span> <span class="mo">04</span><span class="p">,</span> <span class="mo">01</span><span class="p">)</span>  <span class="c1"># year, month, day</span>


<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;livejournal/login&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;livejournal/entry&#39;</span>

<span class="nb">puts</span> <span class="s2">&quot;Logging in...&quot;</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">LiveJournal</span><span class="o">::</span><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">USERNAME</span><span class="p">,</span> <span class="no">PASSWORD</span><span class="p">)</span>
<span class="n">login</span> <span class="o">=</span> <span class="no">LiveJournal</span><span class="o">::</span><span class="no">Request</span><span class="o">::</span><span class="no">Login</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="n">login</span><span class="o">.</span><span class="n">run</span>
<span class="nb">puts</span> <span class="s2">&quot;Login response:&quot;</span>
<span class="n">login</span><span class="o">.</span><span class="n">dumpresponse</span>

<span class="nb">puts</span> <span class="s2">&quot;Getting entries...&quot;</span>
<span class="n">entries</span> <span class="o">=</span> <span class="no">LiveJournal</span><span class="o">::</span><span class="no">Request</span><span class="o">::</span><span class="no">GetEvents</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">:recent</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">values</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">.</span><span class="n">time</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="s2">&quot;Processing entries...&quot;</span>
<span class="n">entries</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="no">MAKE_PRIVATE_BEFORE</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">security</span> <span class="o">!=</span> <span class="ss">:private</span>
    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Making private...&quot;</span>
    <span class="n">e</span><span class="o">.</span><span class="n">security</span> <span class="o">=</span> <span class="ss">:private</span>
    <span class="no">LiveJournal</span><span class="o">::</span><span class="no">Request</span><span class="o">::</span><span class="no">EditEvent</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">run</span>
  <span class="k">end</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Security: </span><span class="si">#{</span><span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">security</span><span class="p">;</span>  <span class="n">s</span> <span class="o">==</span> <span class="ss">:private</span> <span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">upcase</span> <span class="p">:</span> <span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">&quot;All done.&quot;</span>
</pre>
</div>

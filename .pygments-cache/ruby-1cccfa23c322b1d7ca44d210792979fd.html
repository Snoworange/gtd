<div class="highlight"><pre><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># By Henrik Nyh 2007-09-11.</span>
<span class="c1"># Free to modify and redistribute with due credit.</span>


<span class="c1"># Change these:</span>

<span class="no">USERNAME</span> <span class="o">=</span> <span class="s1">&#39;frank&#39;</span>
<span class="no">PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;sesame&#39;</span>

<span class="no">REPLACE_FROM</span> <span class="o">=</span> <span class="s1">&#39;myoldsite.com&#39;</span>
<span class="no">REPLACE_UNTO</span> <span class="o">=</span> <span class="s1">&#39;mynewsite.com&#39;</span>


<span class="c1"># Leave these alone unless you know what you&#39;re doing:</span>

<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;livejournal/login&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;livejournal/entry&#39;</span>

<span class="c1"># So the livejournal gem doesn&#39;t choke:</span>
<span class="c1"># http://henrik.nyh.se/2007/04/ruby-livejournal-batch-private#comments</span>
<span class="no">LiveJournal</span><span class="o">::</span><span class="no">Entry</span><span class="o">::</span><span class="no">KNOWN_EXTRA_PROPS</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;used_rte&quot;</span>

<span class="nb">puts</span> <span class="s2">&quot;Logging in...&quot;</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">LiveJournal</span><span class="o">::</span><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">USERNAME</span><span class="p">,</span> <span class="no">PASSWORD</span><span class="p">)</span>
<span class="n">login</span> <span class="o">=</span> <span class="no">LiveJournal</span><span class="o">::</span><span class="no">Request</span><span class="o">::</span><span class="no">Login</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="n">login</span><span class="o">.</span><span class="n">run</span>
<span class="nb">puts</span> <span class="s2">&quot;Login response:&quot;</span>
<span class="n">login</span><span class="o">.</span><span class="n">dumpresponse</span>

<span class="nb">puts</span> <span class="s2">&quot;Getting entries...&quot;</span>
<span class="n">entries</span> <span class="o">=</span> <span class="no">LiveJournal</span><span class="o">::</span><span class="no">Request</span><span class="o">::</span><span class="no">GetEvents</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">:recent</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">values</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">.</span><span class="n">time</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="s2">&quot;Processing entries...&quot;</span>
<span class="n">entries</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">e</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="no">REPLACE_FROM</span><span class="p">,</span> <span class="no">REPLACE_UNTO</span><span class="p">)</span>
  <span class="no">LiveJournal</span><span class="o">::</span><span class="no">Request</span><span class="o">::</span><span class="no">EditEvent</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">run</span>
  <span class="nb">puts</span> <span class="n">e</span><span class="o">.</span><span class="n">event</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">&quot;All done.&quot;</span>
</pre>
</div>

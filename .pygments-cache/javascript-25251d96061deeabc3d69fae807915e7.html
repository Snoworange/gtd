<div class="highlight"><pre><span class="kd">var</span> <span class="nx">itemBeingDragged</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">scrollPoll</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">getWindowScroll</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">W</span><span class="p">,</span> <span class="nx">H</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nb">window</span><span class="p">;</span>
  <span class="kd">with</span> <span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">&amp;&amp;</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">T</span> <span class="o">=</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
      <span class="nx">L</span> <span class="o">=</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">T</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
      <span class="nx">L</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">W</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
      <span class="nx">H</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">&amp;&amp;</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">W</span> <span class="o">=</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span>
      <span class="nx">H</span> <span class="o">=</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">W</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
      <span class="nx">H</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">offsetHeight</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">{</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">W</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">H</span> <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">findTopY</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">curtop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">curtop</span> <span class="o">+=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">curtop</span> <span class="o">+=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">curtop</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">findBottomY</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">findTopY</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">scrollSome</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">scroller</span> <span class="o">=</span> <span class="nx">getWindowScroll</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">yTop</span> <span class="o">=</span> <span class="nx">findTopY</span><span class="p">(</span><span class="nx">itemBeingDragged</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">yBottom</span> <span class="o">=</span> <span class="nx">findBottomY</span><span class="p">(</span><span class="nx">itemBeingDragged</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">yBottom</span> <span class="o">&gt;</span> <span class="nx">scroller</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">scroller</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">scroller</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="mi">30</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yTop</span> <span class="o">&lt;</span> <span class="nx">scroller</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">scroller</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="mi">30</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">scrollStart</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">itemBeingDragged</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
  <span class="nx">scrollPoll</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">scrollSome</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">scrollEnd</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">scrollPoll</span><span class="p">);</span>
<span class="p">}</span>
</pre>
</div>

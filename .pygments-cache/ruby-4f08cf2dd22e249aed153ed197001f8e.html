<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="k">module</span> <span class="nn">AuthenticationExtension</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
      <span class="n">klass</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
        <span class="kp">attr_reader</span> <span class="ss">:password</span>
        <span class="n">validates_presence_of</span> <span class="ss">:password_hash</span>

        <span class="kp">extend</span>  <span class="no">ClassMethods</span>
        <span class="kp">include</span> <span class="no">InstanceMethods</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">ClassMethods</span>
       <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
         <span class="c1"># ...</span>
       <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">InstanceMethods</span>
       <span class="k">def</span> <span class="nf">password</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
         <span class="c1"># ...</span>
       <span class="k">end</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>

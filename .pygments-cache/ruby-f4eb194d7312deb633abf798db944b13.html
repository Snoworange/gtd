<div class="highlight"><pre><span class="c1">#! /usr/bin/env ruby</span>

<span class="c1"># Henrik Nyh &lt;http://henrik.nyh.se&gt; 2006-09-27</span>
<span class="c1"># Free to modify and redistribute non-commercially with due credit.</span>

<span class="c1"># Turns integer strings into Swedish words. Handles units up to and including &quot;centiljard&quot;, per &lt;http://sv.wikipedia.org/wiki/R%C3%A4kneord#Lista_.C3.B6ver_r.C3.A4kneord&gt;.</span>

<span class="k">class</span> <span class="nc">Array</span>
  <span class="k">def</span> <span class="nf">singles</span><span class="p">;</span> <span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="k">end</span>
  <span class="k">def</span> <span class="nf">tens</span><span class="p">;</span> <span class="n">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="k">end</span>
  <span class="k">def</span> <span class="nf">hundreds</span><span class="p">;</span> <span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">tens?</span>
    <span class="n">tens</span> <span class="ow">and</span> <span class="n">tens</span><span class="o">.</span><span class="n">nonzero?</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">hundreds?</span>
    <span class="n">hundreds</span> <span class="ow">and</span> <span class="n">hundreds</span><span class="o">.</span><span class="n">nonzero?</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">contain_positive_integers?</span>
    <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span><span class="o">|</span><span class="n">int</span><span class="o">|</span> <span class="nb">self</span><span class="o">.</span><span class="n">include?</span> <span class="n">int</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Integer</span>
  <span class="no">SINGLES</span> <span class="o">=</span> <span class="sx">%w{noll ett två tre fyra fem sex sju åtta nio}</span>
  <span class="no">TEENS</span> <span class="o">=</span> <span class="sx">%w{tio elva tolv tretton fjorton femton sexton sjutton arton nitton}</span>
  <span class="no">TENS</span> <span class="o">=</span> <span class="sx">%w{_ _ tjugo trettio fyrtio femtio sextio sjuttio åttio nittio}</span>
  <span class="no">HUNDREDS</span><span class="p">,</span> <span class="no">GOOGOLS</span><span class="p">,</span> <span class="no">CENTILLIONS</span><span class="p">,</span> <span class="no">CENTILLIARDS</span> <span class="o">=</span> <span class="sx">%w{hundra googoler centiljoner centiljarder}</span>
  <span class="no">CUBES</span> <span class="o">=</span> <span class="sx">%w{tusen}</span>
  <span class="sx">%w{m b tr kvadr kvint sext sept okt non dec undec duodec tredec quattuordec quindec sexdec septendec octodec novemdec vigint}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">prefix</span><span class="o">|</span>
    <span class="no">CUBES</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">iljoner&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">iljarder&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">to_swedish</span>
    <span class="nb">Integer</span><span class="o">.</span><span class="n">to_swedish</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">to_swedish</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/\d/</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">.</span><span class="n">to_i</span><span class="p">}</span><span class="o">.</span><span class="n">reverse</span>  <span class="c1"># &quot;00123&quot; becomes [3,2,1,0,0]</span>
    <span class="n">number</span><span class="o">.</span><span class="n">pop</span> <span class="k">while</span> <span class="n">number</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">number</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">zero?</span>

    <span class="k">return</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">empty?</span>
    <span class="k">return</span> <span class="no">SINGLES</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="o">[</span><span class="mi">0</span><span class="o">]</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">below_thousand</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

    <span class="no">CUBES</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span><span class="n">index</span><span class="o">|</span>
      <span class="n">exponent</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
      <span class="k">case</span> <span class="n">exponent</span>
      <span class="k">when</span> <span class="mi">99</span>  <span class="c1"># special treatment for sexdeciljard since 10^100 is googol</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="no">GOOGOLS</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="k">when</span> <span class="mi">123</span>  <span class="c1"># vigintiljard spans 10^123 - 10^599</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="mi">123</span><span class="o">.</span><span class="n">.</span><span class="mi">599</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">output</span> <span class="o">+=</span> <span class="n">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="no">CENTILLIONS</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="n">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="no">CENTILLIARDS</span><span class="p">,</span> <span class="mi">603</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="c1"># Fix singular determiners</span>
    <span class="n">output</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\bett (\w+)er/</span><span class="p">,</span> <span class="s1">&#39;en \1&#39;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/ett (\w+er)/</span><span class="p">,</span> <span class="s1">&#39;en \1&#39;</span><span class="p">)</span>

    <span class="n">output</span>
  <span class="k">end</span>

  <span class="kp">private</span>  <span class="c1"># Helper methods</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">below_thousand</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>  <span class="c1"># Turns e.g. [3,2,1] (for 123) into words</span>
    <span class="k">return</span> <span class="o">[]</span> <span class="k">unless</span> <span class="n">number</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="o">].</span><span class="n">contain_positive_integers?</span>
    <span class="n">output</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">tens</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="no">TEENS</span><span class="o">[</span><span class="n">number</span><span class="o">.</span><span class="n">singles</span><span class="o">]</span>
    <span class="k">else</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="no">SINGLES</span><span class="o">[</span><span class="n">number</span><span class="o">.</span><span class="n">singles</span><span class="o">]</span> <span class="k">unless</span> <span class="n">number</span><span class="o">.</span><span class="n">singles</span><span class="o">.</span><span class="n">zero?</span>
      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="no">TENS</span><span class="o">[</span><span class="n">number</span><span class="o">.</span><span class="n">tens</span><span class="o">]</span> <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">tens?</span>
    <span class="k">end</span>
    <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="no">HUNDREDS</span> <span class="o">&lt;&lt;</span> <span class="no">SINGLES</span><span class="o">[</span><span class="n">number</span><span class="o">.</span><span class="n">hundreds</span><span class="o">]</span> <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">hundreds?</span>
    <span class="o">[</span><span class="n">output</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">unit</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">exponent_or_range</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># The amount of a unit, ranging over part of the number</span>
    <span class="n">list</span> <span class="o">=</span> <span class="k">if</span> <span class="n">exponent_or_range</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Range</span><span class="p">)</span> <span class="k">then</span> <span class="n">number</span><span class="o">[</span><span class="n">exponent_or_range</span><span class="o">]</span> <span class="k">else</span> <span class="n">number</span><span class="o">[</span><span class="n">exponent_or_range</span><span class="p">,</span><span class="n">places</span><span class="o">]</span> <span class="k">end</span>
    <span class="k">return</span> <span class="o">[]</span> <span class="k">unless</span> <span class="n">list</span> <span class="ow">and</span> <span class="n">list</span><span class="o">.</span><span class="n">contain_positive_integers?</span>
    <span class="o">[</span><span class="n">unit</span><span class="p">,</span> <span class="n">to_swedish</span><span class="p">(</span><span class="n">list</span><span class="o">.</span><span class="n">reverse</span><span class="p">)</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">if</span> <span class="bp">__FILE__</span> <span class="o">==</span> <span class="vg">$0</span>
  <span class="c1"># Test run</span>
  <span class="nb">puts</span> <span class="nb">Integer</span><span class="o">.</span><span class="n">to_swedish</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="mi">0</span><span class="o">.</span><span class="n">to_swedish</span>
  <span class="nb">puts</span> <span class="nb">Integer</span><span class="o">.</span><span class="n">to_swedish</span><span class="p">(</span><span class="s2">&quot;000foo0001&quot;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="nb">Integer</span><span class="o">.</span><span class="n">to_swedish</span><span class="p">(</span><span class="s2">&quot;1,024,908,267,229&quot;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="nb">Integer</span><span class="o">.</span><span class="n">to_swedish</span><span class="p">(</span><span class="s2">&quot;1.</span><span class="si">#{</span><span class="s2">&quot;0&quot;</span><span class="o">*</span><span class="mi">1_205</span><span class="si">}</span><span class="s2">1&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre>
</div>
